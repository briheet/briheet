<!DOCTYPE html>
<html lang="en-us">
  <head>

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/images/site.webmanifest">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Notes on wiring a Zig project to build cleanly with foriegn dependencies inside a Nix shell.">
    <title>Building in Zig with foreign dependencies and Nix-Shell | Home</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://www.briheet.com/css/theme-override.css">
    
  </head>

  <body>
    <header>
      <nav>
        <ul>
          
          
          <li class="pull-left ">
            <a href="https://www.briheet.com/">~/home</a>
          </li>
          
          
          <li class="pull-left current">
            <a href="/blogs/">~/blogs</a>
          </li>
          

          

        </ul>
      </nav>
    </header>


<div class="article-meta">
<h1><span class="title">Building in Zig with foreign dependencies and Nix-Shell</span></h1>

<h2 class="date">2025/11/23</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/blogs">blogs</a> 
  
  
  
  Tags: <a href="/tags/zig">Zig</a> <a href="/tags/nix">Nix</a> 
  
  
</p>
</div>



<div class="content-wrapper">
  <main>
    <h1 id="intro">Intro</h1>
<p>Hi guys, how are you guys doing ?</p>
<p>Recently a bunch of college friends asked me about my experiences with Zig, and i&rsquo;ll be honest, it&rsquo;s been great.
I like using allocators, comptime and many other features. I also love <strong>Nix</strong>.</p>
<p>So one of them asked me if i could demonstrate him by building an application with it. I was like yea sure, i&rsquo;ll write up a doc and share it with ya.</p>
<p>But the process of adding images and stuff and sharing with many people (if anyone else asks) is hard. So i decided to write a small blog post on it. Makes more sense to someone</p>
<h1 id="topic">Topic</h1>
<p>As we know, a new init of a software system is usually paired up with a good cli. A good cli system with subcommands and flags helps a lot.</p>
<p>In a good backend system things like schedulers, workers, different process can be triggered via subcommands and multiple flag options helps a lot.</p>
<p>Hence today we are gonna build a new project in zig, add a cli dependency and build and run it. Hope it does makes sense &#x1f62d;</p>
<h1 id="lets-work-on">Let&rsquo;s work on</h1>
<h2 id="installing-nix">Installing Nix</h2>
<p>I am a huge <strong>Nix</strong> fan and use <a href="https://github.com/nix-darwin/nix-darwin">nix-darwin</a> as my daily driver, i would be using nix-shell to manage all.</p>
<p>Also to be presice, i dont want to use flakes rn so that i dont have to turn on the experimental feature and making you the user to fuckup the process of learning. I want you to enjoy. So i&rsquo;ll be avoiding flaks rn.</p>
<p>For new users to <strong>Nix</strong>, i will suggest you to go to this link <a href="https://nix.dev/install-nix.html">Install Nix</a> to install nix on your operating system.
You&rsquo;ll see something like this <img src="nix-install-page.png" alt="Nix install page">
Please install according to your system requirements.</p>
<p>After installation, lets learn a bit about nix-shell. <a href="https://nixos.wiki/wiki/Development_environment_with_nix-shell">Click on this</a>.
You&rsquo;ll see something like this <img src="nix-shell.png" alt="Read about nix-shell"> Go on, read about it. Knowledge is necessary.</p>
<h2 id="setting-up-nix-shell-installing-zig-and-zig-language-server">Setting up Nix-Shell, installing Zig and Zig language server</h2>
<p>So now you should be able to spin up nix-shell&rsquo;s properly and manage. One thing to try to test this out is this <img src="nix-shell_use.png" alt="Test nix-shell"></p>
<p>Cool then. Let&rsquo;s start writing a shell.nix file for spinnig up the shell. So we dont want to install our dependencies system wide hence we would declare them in shell.nix file, spin it up and therefore use it.</p>
<p>Make a new file named <strong>shell.nix</strong> in the project root. Add this piece of code there.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">{</span> pkgs ? import &lt;nixpkgs&gt; <span style="color:#f92672">{}</span> <span style="color:#f92672">}</span>:
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>pkgs.mkShell <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  buildInputs <span style="color:#f92672">=</span> with pkgs; <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    pkgs.zig_0_15
</span></span><span style="display:flex;"><span>    pkgs.zls
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  shellHook <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    alias ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls -al&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>It would look like this, <img src="nix-shell_photo.png" alt="Nix-shell_photo"></p>
<p>Note: this uses Zig 0.15.x via <code>pkgs.zig_0_15</code>. If your nixpkgs channel doesn&rsquo;t have it (some stable channels), either pin a nixpkgs revision that does or pull from an unstable channel before running nix-shell.</p>
<p>Cool, now run <strong>nix-shell</strong> in root of your project and it should give you a shell with zig and zls installed. <img src="zig_zls.png" alt="Zig_zls_installed"></p>
<p>The nix-shell here quietly picked up the shell.nix file and did his job. Either you specify the file name like &ldquo;nix-shell someShellfile.nix&rdquo; or just do &ldquo;nix-shell&rdquo; and let it pick up.
Also remember, Just doing &ldquo;nix-shell&rdquo; will only pickup files named shell.nix and default.nix</p>
<p>Don&rsquo;t get confused by my text editor, i use <strong>Helix</strong>. Now you have everything setup, lets move ahead.</p>
<h2 id="init-a-new-zig-project-run-hello-world">Init a new zig project, run &ldquo;Hello, world!&rdquo;</h2>
<p>Now we will init a minimal zig project, write a hello world code and run it.
Here is the way for it with code <img src="zig_build.png" alt="Zig_hello"></p>
<p>Click the highlighted text to learn more about <a href="https://ziglang.org/documentation/0.15.2/">Zig</a></p>
<h2 id="setup-zigs-build-system">Setup Zig&rsquo;s build system</h2>
<p>This is fairly easy part. You need to add it as executable in build.zig file like this. <img src="zig_exe_build.png" alt="Zig_exe_build"></p>
<p>Now as exe is added, you can build and run the binary like this. <img src="zig_exe_run.png" alt="Zig_exe_run"></p>
<p>Cool, now lets work on adding the CLI module.</p>
<h2 id="adding-cli-module">Adding CLI module</h2>
<p>We are going to use this module <a href="https://github.com/sam701/zig-cli">Zig&rsquo;s Cli Module</a>. Pretty nice, works fine.</p>
<p>At first, we will fetch the cli in our root module that is this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>zig fetch --save git+https://github.com/sam701/zig-cli#zig-0.15
</span></span></code></pre></div><p>Now check your build.zig.zon, you&rsquo;ll see something. Search about the file name and its role.</p>
<p>Now we add it in our build system. Like this, <img src="zig_cli_build_add.png" alt="Zig_cli_import"></p>
<p>Here is the code for build.zig.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>const std <span style="color:#f92672">=</span> @import<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;std&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pub fn build<span style="color:#f92672">(</span>b: *std.Build<span style="color:#f92672">)</span> void <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    const target <span style="color:#f92672">=</span> b.standardTargetOptions<span style="color:#f92672">(</span>.<span style="color:#f92672">{})</span>;
</span></span><span style="display:flex;"><span>    const optimize <span style="color:#f92672">=</span> b.standardOptimizeOption<span style="color:#f92672">(</span>.<span style="color:#f92672">{})</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const executable <span style="color:#f92672">=</span> b.addExecutable<span style="color:#f92672">(</span>.<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        .name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;zig_cli&#34;</span>,
</span></span><span style="display:flex;"><span>        .root_module <span style="color:#f92672">=</span> b.createModule<span style="color:#f92672">(</span>.<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            .root_source_file <span style="color:#f92672">=</span> b.path<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;src/main.zig&#34;</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>            .target <span style="color:#f92672">=</span> b.graph.host,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">})</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">})</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const cli <span style="color:#f92672">=</span> b.dependency<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cli&#34;</span>, .<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        .target <span style="color:#f92672">=</span> target,
</span></span><span style="display:flex;"><span>        .optimize <span style="color:#f92672">=</span> optimize,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">})</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    executable.root_module.addImport<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cli&#34;</span>, cli.module<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cli&#34;</span><span style="color:#f92672">))</span>;
</span></span><span style="display:flex;"><span>    b.installArtifact<span style="color:#f92672">(</span>executable<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Cool, now CLI module is added, lets move on to write a minimal cli setup and execute it.</p>
<h2 id="minimal-cli-setup-and-execution">Minimal CLI setup and execution</h2>
<p>Here is a minimal CLI code setup. For simplicity i have just kept it as root commands and no subCommands or flags or anything.
For more info on how to, please refer these <a href="https://github.com/sam701/zig-cli/tree/main/examples">examples</a>.</p>
<p><img src="zig_cli_code.png" alt="Zig_cli_code"></p>
<p>Here is the code for src/main.zig.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>const std <span style="color:#f92672">=</span> @import<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;std&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>const cli <span style="color:#f92672">=</span> @import<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cli&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pub fn main<span style="color:#f92672">()</span> !void <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    // Some kind of cli to work up things
</span></span><span style="display:flex;"><span>    var r <span style="color:#f92672">=</span> try cli.AppRunner.init<span style="color:#f92672">(</span>std.heap.page_allocator<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const App <span style="color:#f92672">=</span> cli.App<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        .command <span style="color:#f92672">=</span> cli.Command<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            .name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;server&#34;</span>,
</span></span><span style="display:flex;"><span>            .description <span style="color:#f92672">=</span> cli.Description<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                .one_line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a simple zig cli application.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            .target <span style="color:#f92672">=</span> cli.CommandTarget<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                .action <span style="color:#f92672">=</span> cli.CommandAction<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    .exec <span style="color:#f92672">=</span> run_server,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r.run<span style="color:#f92672">(</span>&amp;App<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pub fn run_server<span style="color:#f92672">()</span> !void <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    std.debug.print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hi from Zig {s}&#34;</span>, .<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;Cli&#34;</span><span style="color:#f92672">})</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Here is how you execute it.
<img src="zig_cli_code_run.png" alt="Zig_cli_code_run"></p>
<p>So yeah, that was the most part. This is how you minimally build projects in zig, add dependencies, etc.</p>
<h2 id="ending">Ending</h2>
<p>This was one of the ways to do build and execute stuff. Pretty interseting tbh. Also, this was very surface level way to do it. My main goal here was introduction, and trying to spark interest among others.</p>
<p>Besides this, there are many ways, compiler optimisations, and multiple things to do but i tried keeping it simple and sane so any person can start with it or feed it into LLM to understand it.</p>
<p><strong>Zig</strong> is this language which is really fasinating. I used to write Rust previously and C++ professionally aswell but i never got this level of joy in writing code. Only with <strong>GO</strong>, never with other languages.
Also please sometime use <strong>Go to definition</strong> in your zig codebase and see how easy and simple things are written in codebase. Pretty wild that things can be so simple and understandable.</p>
<p>Also my love for <strong>NIX</strong> is ever-growing. I recently switched to <strong>Home manager</strong> and life is nice. Here are my <a href="https://github.com/briheet/nix-config">dotfiles</a>.
Also don&rsquo;t forget to collect garbage &#x1f62d; (nix-collect-garbage -d).</p>

    <a href="/"> >> Home</a>
  </main>
</div>
    <footer>
      
      
      <script>
      (function() {
        function center_el(tagName) {
          var tags = document.getElementsByTagName(tagName), i, tag;
          for (i = 0; i < tags.length; i++) {
            tag = tags[i];
            var parent = tag.parentElement;
            
            if (parent.childNodes.length === 1) {
              
              if (parent.nodeName === 'A') {
                parent = parent.parentElement;
                if (parent.childNodes.length != 1) continue;
              }
              if (parent.nodeName === 'P') parent.style.textAlign = 'center';
            }
          }
        }
        var tagNames = ['img', 'embed', 'object'];
        for (var i = 0; i < tagNames.length; i++) {
          center_el(tagNames[i]);
        }
      })();
      </script>

      
      <hr/>
      <a target="_blank" rel="noopener noreferrer" href="https://github.com/briheet">Github</a> | <a target="_blank" rel="noopener noreferrer" href="https://x.com/brsy_10">X</a> | <a target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/briheet-singh-yadav/">Linkedin</a> | <a target="_blank" rel="noopener noreferrer" href="https://drive.google.com/file/d/1bV-Mwxg_FAKe0rIp1-YmNlY1BAmIIZk7/view?usp=sharing">Resume</a>
      
    </footer>
  </body>
</html>

